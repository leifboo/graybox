/*
    GrayBox
    Copyright (C) 2010  Leif Strand

    This program is free software: you can redistribute this file
    and/or modify it under the terms of version 2 of the GNU General
    Public License as published by the Free Software Foundation.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

#include "Logging.h"

#if LOGGING

#include "vMac.h"

#include <Traps.h>

#include <stdio.h>
#include <stdlib.h>
#include <string.h>


static const char *osTrapName[0x100] = {
    "Open",
    "Close",
    "Read",
    "Write",
    "Control",
    "Status",
    "KillIO",
    "GetVolInfo",
    "Create",
    "Delete",
    "OpenRF",
    "ReName",
    "GetFileInfo",
    "SetFileInfo",
    "UnMountVol",
    "MountVol",
    "Allocate",
    "GetEOF",
    "SetEOF",
    "FlushVol",
    "GetVol",
    "SetVol",
    "FInitQueue",
    "Eject",
    "GetFPos",
    "InitZone",
    "GetZone",
    "SetZone",
    "FreeMem",
    "MaxMem",
    "NewPtr",
    "DisposPtr",
    "SetPtrSize",
    "GetPtrSize",
    "NewHandle",
    "DisposHandle",
    "SetHandleSize",
    "GetHandleSize",
    "HandleZone",
    "ReAllocHandle",
    "RecoverHandle",
    "HLock",
    "HUnLock",
    "EmptyHandle",
    "InitApplZone",
    "SetApplLimit",
    "BlockMove",
    "PostEvent",
    "OSEventAvail",
    "GetOSEvent",
    "FlushEvents",
    "VInstall",
    "VRemove",
    "OffLine",
    "MoreMasters",
    "ReadParam",
    "WriteParam",
    "ReadDateTime",
    "SetDateTime",
    "Delay",
    "CmpString",
    "DrvrInstall",
    "DrvrRemove",
    "InitUtil",
    "ResrvMem",
    "SetFilLock",
    "RstFilLock",
    "SetFilType",
    "SetFPos",
    "FlushFile",
    "GetTrapAddress",
    "SetTrapAddress",
    "PtrZone",
    "HPurge",
    "HNoPurge",
    "SetGrowZone",
    "CompactMem",
    "PurgeMem",
    "AddDrive",
    "RDrvrInstall",
    "RelString",
    "ReadXPRam",
    "WriteXPRam",
    "ClkNoMem",
    "UprString",
    "StripAddress",
    "LwrString",
    "SetAppBase",
    "InsTime",
    "RmvTime",
    "PrimeTime",
    "PowerOFF",
    "VM_Dispatch",
    "SwapMMUMode",
    "NMInstall",
    "NMRemove",
    "HFsDispatch",
    "MaxBlock",
    "PurgeSpace",
    "MaxApplZone",
    "MoveHHi",
    "StackSpace",
    "NewEmptyHandle",
    "HSetRBit",
    "HClrRBit",
    "HGetState",
    "HSetState",
    "SI_TestMgr",
    "InitFs",
    "InitEvents",
    "SlotManager",
    "SlotVInstall",
    "SlotVRemove",
    "AttachVBL",
    "DoVBLTask",
    "Reserved4",
    "CacheMgr",
    "SIntInstall",
    "SIntRemove",
    "CountADBs",
    "GetIndADB",
    "GetADBInfo",
    "SetADBInfo",
    "ADBReInit",
    "ADBOp",
    "GetDefaultStartup",
    "SetDefaultStartup",
    "InternalWait",
    "GetVideoDefault",
    "SetVideoDefault",
    "DTInstall",
    "SetOSDefault",
    "GetOSDefault",
    "PowerMgr",
    "IOPInfoAccess",
    "IOPMsgRequest",
    "IOPMoveData",
    "SCSIAtomic",
    "Sleep",
    "CommToolboxDispatch",
    "Wakeup",
    "DebugUtil",
    "BTreeDispatch",
    "DeferUserFn",
    "SysEnvirons",
    "Xlate24to32",
    "EgretDispatch",
    "MicroTickCount",
    "ServerDispatch",
    "Myst_95",
    "Myst_96",
    "FPPriv",
    "HWPriv",
    "XToolTable",
    "vProcHelper",
    "Messager",
    "NewPtrStartup",
    "MoveHLow",
    "PowerDispatchPublic",
    "Power",
    "Myst_A0",
    "Myst_A1",
    "Myst_A2",
    "Myst_A3",
    "HeapDispatch",
    "VisRegionChanged",
    "Myst_A6",
    "Myst_A7",
    "Myst_A8",
    "Myst_A9",
    "Myst_AA",
    "Myst_AB",
    "FileSysMgr",
    "Gestalt",
    "Myst_AE",
    "Myst_AF",
    "Myst_B0",
    "Myst_B1",
    "Myst_B2",
    "Myst_B3",
    "Myst_B4",
    "jGoDriver",
    "jWaitUntil",
    "jSyncWait",
    "jSoundDead",
    "jDisptch",
    "jIAZInit",
    "jIAZPostInit",
    "jLaunchInit",
    "jCacheFlush",
    "jSysUtil",
    "jLg2Phys",
    "jFlushCache",
    "jGetBlock",
    "jMarkBlock",
    "jRelBlock",
    "jTrashBlocks",
    "jTrashVBlks",
    "jCacheWrIP",
    "jCacheRdIP",
    "jBasicIO",
    "jRdBlocks",
    "jWrBlocks",
    "jSetUpTags",
    "jBTClose",
    "jBTDelete",
    "jBTFlush",
    "jBTGetRecord",
    "jBTInsert",
    "jBTOpen",
    "jBTSearch",
    "jBTUpdate",
    "jGetNode",
    "jRelNode",
    "jAllocNode",
    "jFreeNode",
    "jExtBTFile",
    "jDeallocFile",
    "jExtendFile",
    "jTruncateFile",
    "jCMSetUp",
    "PPCToolBoxMgr",
    "jDtrmV1",
    "jBlkAlloc",
    "jBlkDeAlloc",
    "jFileOpen",
    "jPermssnChk",
    "jFndFilName",
    "jRfNCall",
    "jAdjEOF",
    "jPixel2Char",
    "jChar2Pixel",
    "jHiliteText",
    "jFileClose",
    "jFileRead",
    "jFileWrite",
    "jDispatchHelper",
    "jUpdAldMDB",
    "jCkExtFs",
    "jDTrmV3",
    "jBMChk",
    "jTstMod",
    "jLocCRec",
    "jTreeSearch",
    "jMapFBlock",
    "jXFSearch",
    "jReadBM",
    "jDoEject",
    "jSegStack",
    "jSuperLoad",
    "jCmpFrm",
    "jNewMap",
    "jCheckLoad",
    "TETrimMeasure",
    "TEFindWord",
    "TEFindLine"
};


static const char *tbTrapName[0x400] = {
    "SoundDispatch",
    "SndDisposeChannel",
    "SndAddModifier",
    "SndDoCommand",
    "SndDoImmediate",
    "SndPlay",
    "SndControl",
    "SndNewChannel",
    "InitProcMenu",
    "GetCVariant",
    "GetWVariant",
    "PopUpMenuSelect",
    "RGetResource",
    "Count1Resources",
    "Get1IxResource",
    "Get1IxType",
    "Unique1ID",
    "TeSelView",
    "TePinScroll",
    "TeAutoView",
    "SetFractEnable",
    "SCSiDispatch",
    "Pack8",
    "CopyMask",
    "FixAtan2",
    "XMunger",
    "HOpenResFile",
    "HCreateResFile",
    "Count1Types",
    "InvalMenuBar",
    "SaveRestoreBits",
    "Get1Resource",
    "Get1NamedResource",
    "MaxSizeRsrc",
    "RsrcMgr",
    "AliasMgr",
    "HFSUtils",
    "MenuDispatch",
    "InsMenuItem",
    "HideD_Item",
    "ShowD_Item",
    "LayerDispatch",
    "ComponentDispatch",
    "PPCBrowser",
    "Pack10",
    "DataPubMgr",
    "Pack12",
    "DatBaseMgr",
    "Help_Pack",
    "Pack15",
    "QD_GX_Mgr",
    "ScrnBitMap",
    "SetFScaleDisable",
    "FontMetrics",
    "GetMaskTable",
    "MeasureText",
    "CalcMask",
    "SeedFill",
    "ZoomWindow",
    "TrackBox",
    "TEGetOffset",
    "TEDispatch",
    "TEStyleNew",
    "Long2Fix",
    "Fix2Long",
    "Fix2Frac",
    "Fract2Fix",
    "Fix2X",
    "X2Fix",
    "Frac2X",
    "X2Frac",
    "FracCos",
    "FracSin",
    "FracSqrt",
    "FracMul",
    "FracDiv",
    "ScrollDelay",
    "FixDiv",
    "GetItmCmdkey",
    "SetItmCmdkey",
    "InitCursor",
    "SetCursor",
    "HideCursor",
    "ShowCursor",
    "FontDispatch",
    "ShieldCursor",
    "ObscureCursor",
    "Myst_857",
    "BitAnd",
    "BitXOr",
    "BitNot",
    "BitOr",
    "BitShift",
    "BitTst",
    "BitSet",
    "BitClr",
    "WaitNextEvent",
    "Random",
    "ForeColor",
    "BackColor",
    "ColorBit",
    "GetPixel",
    "StuffHex",
    "LongMul",
    "FixMul",
    "FixRatio",
    "HiWord",
    "LoWord",
    "FixRound",
    "InitPort",
    "InitGraf",
    "OpenPort",
    "LocalToGlobal",
    "GlobalToLocal",
    "GrafDevice",
    "SetPort",
    "GetPort",
    "SetPBits",
    "PortSize",
    "MovePortTo",
    "SetOrigin",
    "SetClip",
    "GetClip",
    "ClipRect",
    "BackPat",
    "ClosePort",
    "AddPt",
    "SubPt",
    "SetPt",
    "EqualPt",
    "StdText",
    "DrawChar",
    "DrawString",
    "DrawText",
    "TextWidth",
    "TextFont",
    "TextFace",
    "TextMode",
    "TextSize",
    "GetFontInfo",
    "StringWidth",
    "CharWidth",
    "SpaceExtra",
    "OSDispatch",
    "StdLine",
    "LineTo",
    "Line",
    "MoveTo",
    "Move",
    "ShutDown",
    "HidePen",
    "ShowPen",
    "GetPenState",
    "SetPenState",
    "GetPen",
    "PenSize",
    "PenMode",
    "PenPat",
    "PenNormal",
    "UnimplTrap",
    "StdRect",
    "FrameRect",
    "PaintRect",
    "EraseRect",
    "InverRect",
    "FillRect",
    "EqualRect",
    "SetRect",
    "OffSetRect",
    "InSetRect",
    "SectRect",
    "UnionRect",
    "Pt2Rect",
    "PtInRect",
    "EmptyRect",
    "StdRRect",
    "FrameRoundRect",
    "PaintRoundRect",
    "EraseRoundRect",
    "InverRoundRect",
    "FillRoundRect",
    "ScriptUtil",
    "StdOval",
    "FrameOval",
    "PaintOval",
    "EraseOval",
    "InvertOval",
    "FillOval",
    "SlopeFromAngle",
    "StdArc",
    "FrameArc",
    "PaintArc",
    "EraseArc",
    "InvertArc",
    "FillArc",
    "PtToAngle",
    "AngleFromSlope",
    "StdPoly",
    "FramePoly",
    "PaintPoly",
    "ErasePoly",
    "InvertPoly",
    "FillPoly",
    "OpenPoly",
    "ClosePgon",
    "KillPoly",
    "OffSetPoly",
    "PackBits",
    "UnpackBits",
    "StdRgn",
    "FrameRgn",
    "PaintRgn",
    "EraseRgn",
    "InverRgn",
    "FillRgn",
    "BitmapToRegion",
    "NewRgn",
    "DisposRgn",
    "OpenRgn",
    "CloseRgn",
    "CopyRgn",
    "SetEmptyRgn",
    "SetRecRgn",
    "RectRgn",
    "OfSetRgn",
    "InSetRgn",
    "EmptyRgn",
    "EqualRgn",
    "SectRgn",
    "UnionRgn",
    "DiffRgn",
    "XOrRgn",
    "PtInRgn",
    "RectInRgn",
    "SetStdProcs",
    "StdBits",
    "CopyBits",
    "StdTxMeas",
    "StdGetPic",
    "ScrollRect",
    "StdPutPic",
    "StdComment",
    "PicComment",
    "OpenPicture",
    "ClosePicture",
    "KillPicture",
    "DrawPicture",
    "Reserved11",
    "ScalePt",
    "MapPt",
    "MapRect",
    "MapRgn",
    "MapPoly",
    "PrintMgr",
    "InitFonts",
    "GetFName",
    "GetFNum",
    "FMSwapFont",
    "RealFont",
    "SetFontLock",
    "DrawGrowIcon",
    "DragGrayRgn",
    "NewString",
    "SetString",
    "ShowHide",
    "CalcVis",
    "CalcVBehind",
    "ClipAbove",
    "PaintOne",
    "PaintBehind",
    "SaveOld",
    "DrawNew",
    "GetWMgrPort",
    "CheckUpDate",
    "InitWindows",
    "NewWindow",
    "DisposWindow",
    "ShowWindow",
    "HideWindow",
    "GetWRefCon",
    "SetWRefCon",
    "GetWTitle",
    "SetWTitle",
    "MoveWindow",
    "HiliteWindow",
    "SizeWindow",
    "TrackGoAway",
    "SelectWindow",
    "BringToFront",
    "SendBehind",
    "BeginUpdate",
    "EndUpdate",
    "FrontWindow",
    "DragWindow",
    "DragTheRgn",
    "InvalRgn",
    "InvalRect",
    "ValidRgn",
    "ValidRect",
    "GrowWindow",
    "FindWindow",
    "CloseWindow",
    "SetWindowPic",
    "GetWindowPic",
    "InitMenus",
    "NewMenu",
    "DisposMenu",
    "AppendMenu",
    "ClearMenuBar",
    "InsertMenu",
    "DeleteMenu",
    "DrawMenuBar",
    "HiliteMenu",
    "EnableItem",
    "DisableItem",
    "GetMenuBar",
    "SetMenuBar",
    "MenuSelect",
    "MenuKey",
    "GetItemIcon",
    "SetItemIcon",
    "GetItemStyle",
    "SetItemStyle",
    "GetItemMark",
    "SetItemMark",
    "CheckItem",
    "GetItem",
    "SetItem",
    "CalcMenuSize",
    "GetMHandle",
    "SetMFlash",
    "PlotIcon",
    "FlashMenuBar",
    "AddResMenu",
    "PinRect",
    "DeltaPoint",
    "CountMItems",
    "InsertResMenu",
    "DelMenuItem",
    "UpdateControl",
    "NewControl",
    "DisposControl",
    "KillControls",
    "ShowControl",
    "HideControl",
    "MoveControl",
    "GetCRefCon",
    "SetCRefCon",
    "SizeControl",
    "HiliteControl",
    "GetCTitle",
    "SetCTitle",
    "GetCtlValue",
    "GetMinCtl",
    "GetMaxCtl",
    "SetCtlValue",
    "SetMinCtl",
    "SetMaxCtl",
    "TestControl",
    "DragControl",
    "TrackControl",
    "DrawControls",
    "GetCtlAction",
    "SetCtlAction",
    "FindControl",
    "Draw1Control",
    "DeQueue",
    "EnQueue",
    "GetNextEvent",
    "EventAvail",
    "GetMouse",
    "StillDown",
    "Button",
    "TickCount",
    "GetKeys",
    "WaitMouseUp",
    "UpdtDialog",
    "CouldDialog",
    "FreeDialog",
    "InitDialogs",
    "GetNewDialog",
    "NewDialog",
    "SelIText",
    "IsDialogEvent",
    "DialogSelect",
    "DrawDialog",
    "CloseDialog",
    "DisposDialog",
    "FindD_Item",
    "Alert",
    "StopAlert",
    "NoteAlert",
    "CautionAlert",
    "CouldAlert",
    "FreeAlert",
    "ParamText",
    "ErrorSound",
    "GetDItem",
    "SetDItem",
    "SetIText",
    "GetIText",
    "ModalDialog",
    "DetachResource",
    "SetResPurge",
    "CurResFile",
    "InitResources",
    "RsrcZoneInit",
    "OpenResFile",
    "UseResFile",
    "UpdateResFile",
    "CloseResFile",
    "SetResLoad",
    "CountResources",
    "GetIndResource",
    "CountTypes",
    "GetIndType",
    "GetResource",
    "GetNamedResource",
    "LoadResource",
    "ReleaseResource",
    "HomeResFile",
    "SizeRsrc",
    "GetResAttrs",
    "SetResAttrs",
    "GetResInfo",
    "SetResInfo",
    "ChangedResource",
    "AddResource",
    "AddReference",
    "RmveResource",
    "RmveReference",
    "ResError",
    "WriteResource",
    "CreateResFile",
    "SystemEvent",
    "SystemClick",
    "SystemTask",
    "SystemMenu",
    "OpenDeskAcc",
    "CloseDeskAcc",
    "GetPattern",
    "GetCursor",
    "GetString",
    "GetIcon",
    "GetPicture",
    "GetNewWindow",
    "GetNewControl",
    "GetMenu",
    "GetNewMBar",
    "UniqueID",
    "SysEdit",
    "KeyTrans",
    "OpenRFPerm",
    "RsrcMapEntry",
    "Secs2Date",
    "Date2Secs",
    "SysBeep",
    "SysError",
    "SI_PutIcon",
    "TeGetText",
    "TeInit",
    "TeDispose",
    "TextBox",
    "TeSetText",
    "TeCalText",
    "TeSetSelect",
    "TeNew",
    "TeUpdate",
    "TeClick",
    "TeCopy",
    "TeCut",
    "TeDelete",
    "TeActivate",
    "TeDeactivate",
    "TeIdle",
    "TePaste",
    "TeKey",
    "TeScroll",
    "TeInsert",
    "TeSetJust",
    "Munger",
    "HandToHand",
    "PtrToXHand",
    "PtrToHand",
    "HandAndHand",
    "InitPack",
    "InitAllPacks",
    "Pack0",
    "Pack1",
    "Pack2",
    "Pack3",
    "Pack4",
    "Pack5",
    "Pack6",
    "Pack7",
    "PtrAndHand",
    "LoadSeg",
    "UnLoadSeg",
    "Launch",
    "Chain",
    "ExitToShell",
    "GetAppParms",
    "GetResFileAttrs",
    "SetResFileAttrs",
    "MethodDispatch",
    "InfoScrap",
    "UnlodeScrap",
    "LodeScrap",
    "ZeroScrap",
    "GetScrap",
    "PutScrap",
    "Debugger",
    "XOpenCPort",
    "InitCPort",
    "CloseCPort",
    "NewPixMap",
    "DisposPixMap",
    "CopyPixMap",
    "SetPortPix",
    "NewPixPat",
    "DisposPixPat",
    "CopyPixPat",
    "PenPixPat",
    "BackPixPat",
    "GetPixPat",
    "MakeRGBPat",
    "FillCRect",
    "FillCOval",
    "FillCRoundRect",
    "FillCArc",
    "FillCRgn",
    "FillCPoly",
    "RGBForeColor",
    "RGBBackColor",
    "SetCPixel",
    "GetCPixel",
    "GetCTable",
    "GetForeColor",
    "GetBackColor",
    "GetCCursor",
    "SetCCursor",
    "AllocCursor",
    "GetCIcon",
    "PlotCIcon",
    "OpenCPicture",
    "OpColor",
    "HiliteColor",
    "CharExtra",
    "DisposCTable",
    "DisposCIcon",
    "DisposCCursor",
    "GetMaxDevice",
    "GetCTSeed",
    "GetDeviceList",
    "GetMainDevice",
    "GetNextDevice",
    "TestDeviceAttribute",
    "SetDeviceAttribute",
    "InitGDevice",
    "NewGDevice",
    "DisposGDevice",
    "SetGDevice",
    "GetGDevice",
    "Color2Index",
    "Index2Color",
    "InvertColor",
    "RealColor",
    "GetSubTable",
    "UpdatePixMap",
    "MakeITable",
    "AddSearch",
    "AddComp",
    "SetClientID",
    "ProtectEntry",
    "ReserveEntry",
    "SetEntries",
    "QDError",
    "SetWinColor",
    "GetAuxWin",
    "SetCtlColor",
    "GetAuxCtl",
    "NewCWindow",
    "GetNewCWindow",
    "SetDeskCPat",
    "GetCWMgrPort",
    "SaveEntries",
    "RestoreEntries",
    "NewCDialog",
    "DelSearch",
    "DelComp",
    "SetStdCProcs",
    "CalcCMask",
    "SeedCFill",
    "CopyDeepMask",
    "HighLvlFSDispatch",
    "DictionaryDispatch",
    "TextServDispatch",
    "KobeDispatch",
    "PlainTalk",
    "DockingDispatch",
    "NuKernelDispatch",
    "MixedModeDispatch",
    "CodeFragDispatch",
    "RemoteAccess",
    "OCE_DigSig",
    "OCE_LetterPacking",
    "OCE_MailMessage",
    "OCE_Authentication",
    "DelMCEntries",
    "GetMCInfo",
    "SetMCInfo",
    "DispMCInfo",
    "GetMCEntry",
    "SetMCEntries",
    "MenuChoice",
    "ModalDialogMenuSetup",
    "DialogDispatch",
    "UserNameNotification",
    "DeviceDispatch",
    "PowerPCFuture",
    "PenMacDispatch",
    "LanguageMgrDispatch",
    "AppleGuideDispatch",
    "Myst_A6F",
    "Myst_A70",
    "Myst_A71",
    "Myst_A72",
    "ControlDispatch",
    "AppearanceDispatch",
    "IconServicesDispatch",
    "Myst_A76",
    "Myst_A77",
    "Myst_A78",
    "Myst_A79",
    "Myst_A7A",
    "Myst_A7B",
    "Myst_A7C",
    "Myst_A7D",
    "Myst_A7E",
    "Myst_A7F",
    "Myst_A80",
    "Myst_A81",
    "Myst_A82",
    "Myst_A83",
    "Myst_A84",
    "Myst_A85",
    "Myst_A86",
    "Myst_A87",
    "Myst_A88",
    "Myst_A89",
    "Myst_A8A",
    "Myst_A8B",
    "Myst_A8C",
    "Myst_A8D",
    "Myst_A8E",
    "Myst_A8F",
    "InitPalettes",
    "NewPalette",
    "GetNewPalette",
    "DisposPalette",
    "ActivatePalette",
    "SetPalette",
    "GetPalette",
    "PmForeColor",
    "PmBackColor",
    "AnimateEntry",
    "AnimatePalette",
    "GetEntryColor",
    "SetEntryColor",
    "GetEntryUsage",
    "SetEntryUsage",
    "CTab2Palette",
    "Palette2CTab",
    "CopyPalette",
    "PaletteDispatch",
    "CodecDispatch",
    "Myst_AA4",
    "Myst_AA5",
    "Myst_AA6",
    "Myst_AA7",
    "Myst_AA8",
    "Myst_AA9",
    "QTDispatch",
    "Myst_AAB",
    "Myst_AAC",
    "Myst_AAD",
    "Myst_AAE",
    "Myst_AAF",
    "Myst_AB0",
    "Myst_AB1",
    "Myst_AB2",
    "Myst_AB3",
    "Myst_AB4",
    "Myst_AB5",
    "Myst_AB6",
    "Myst_AB7",
    "Myst_AB8",
    "Myst_AB9",
    "Myst_ABA",
    "Myst_ABB",
    "Myst_ABC",
    "Myst_ABD",
    "Myst_ABE",
    "Myst_ABF",
    "Myst_AC0",
    "Myst_AC1",
    "Myst_AC2",
    "Myst_AC3",
    "Myst_AC4",
    "Myst_AC5",
    "Myst_AC6",
    "Myst_AC7",
    "Myst_AC8",
    "Myst_AC9",
    "Myst_ACA",
    "Myst_ACB",
    "Myst_ACC",
    "Myst_ACD",
    "Myst_ACE",
    "Myst_ACF",
    "Myst_AD0",
    "Myst_AD1",
    "Myst_AD2",
    "Myst_AD3",
    "Myst_AD4",
    "Myst_AD5",
    "Myst_AD6",
    "Myst_AD7",
    "Myst_AD8",
    "Myst_AD9",
    "Myst_ADA",
    "CursorADBDispatch",
    "Myst_ADC",
    "HumanInterfaceUtils",
    "Myst_ADE",
    "Myst_ADF",
    "Myst_AE0",
    "Myst_AE1",
    "Myst_AE2",
    "Myst_AE3",
    "Myst_AE4",
    "Myst_AE5",
    "Myst_AE6",
    "Myst_AE7",
    "Myst_AE8",
    "Myst_AE9",
    "Myst_AEA",
    "Myst_AEB",
    "Myst_AEC",
    "Myst_AED",
    "AppleScript",
    "Myst_AEF",
    "Myst_AF0",
    "ATAManager",
    "ControlStripMgr",
    "ExpansionBusDispatch",
    "InterruptMgrDispatch",
    "Myst_AF5",
    "Myst_AF6",
    "Myst_AF7",
    "Myst_AF8",
    "Myst_AF9",
    "InitApplication",
    "CleanupApplication",
    "Myst_AFC",
    "Myst_AFD",
    "MixedModeMagic",
    "Myst_AFF",
    "qd_BitBlt",
    "qd_BitsToMap",
    "qd_BitsToPix",
    "QD32Trap",
    "qd_ColorMap",
    "qd_CopyHandle",
    "qd_CullPoints",
    "qd_DputpicByte",
    "qd_DputPicop",
    "qd_DrawArc",
    "qd_DrawLine",
    "qd_DrawSlab",
    "qd_FastSlabMode",
    "qd_GetSeek",
    "qd_MakeScaleTbl",
    "qd_Checkpic",
    "qd_Line",
    "qd_OldPatToNew",
    "qd_PackRgn",
    "qd_PatConvert",
    "qd_PatDither",
    "qd_PatExpand",
    "qd_Pinit",
    "qd_PortToMap",
    "qd_PushVerb",
    "qd_PutLine",
    "qd_PutOval",
    "qd_PutRgn",
    "NewTempBuffer",
    "QDOffscreen",
    "DisposeTempBuffer",
    "qd_RgnBlt",
    "qd_RgnOp",
    "qd_Rsect",
    "qd_SeekRgn",
    "qd_SetFillPat",
    "qd_SetupStretch",
    "qd_SlabMode",
    "qd_SortPoints",
    "qd_StretchBits",
    "qd_StdDevLoop",
    "qd_TrimRect",
    "qd_XorSlab",
    "Myst_B2B",
    "Myst_B2C",
    "NewTempHandle",
    "Myst_B2E",
    "Myst_B2F",
    "qd_BMain0",
    "qd_BMain1",
    "qd_BMain2",
    "qd_BMain3",
    "qd_Bsetup8",
    "qd_BMain9",
    "qd_Bsetup10",
    "qd_BMain11",
    "qd_BXMain8",
    "qd_BXMain9",
    "qd_BXMain10",
    "qd_Bxmain11",
    "qd_BCMain0",
    "qd_BCMain1",
    "qd_BHilite",
    "qd_BCMain3",
    "qd_BEnd0",
    "qd_BEnd1",
    "qd_BEnd2",
    "qd_BEnd3",
    "qd_BLong8",
    "qd_BEnd9",
    "qd_BEnd10",
    "qd_BEnd11",
    "qd_BXLong8",
    "qd_BXEnd9",
    "qd_BXEnd10",
    "qd_BXEnd11",
    "qd_BCEnd0",
    "qd_BCEnd1",
    "qd_BSloHilite",
    "qd_BCEnd3",
    "qd_BAvg",
    "qd_BAddPin",
    "qd_BAddOver",
    "qd_BSubPin",
    "qd_BTransparent",
    "qd_BMax",
    "qd_BSubOver",
    "qd_BMin",
    "qd_Bsetup0",
    "qd_BLeft0",
    "qd_Rmask0",
    "qd_Rmask1",
    "qd_Rmask2",
    "qd_Rmask3",
    "qd_Rmask8",
    "qd_Rmask9",
    "qd_Rmask10",
    "qd_Rmask11",
    "qd_RXmask8",
    "qd_RXmask9",
    "qd_RXmask10",
    "qd_RXmask11",
    "qd_RAvg",
    "qd_RAddPin",
    "qd_RAddOver",
    "qd_RSubPin",
    "qd_RTransparent",
    "qd_RMax",
    "qd_RSubOver",
    "qd_RMin",
    "qd_RCmask0",
    "qd_RCmask1",
    "qd_RSlowHilite",
    "qd_RCmask3",
    "qd_RHilite",
    "qd_StMask0",
    "qd_StMask1",
    "qd_StMask2",
    "qd_StMask3",
    "qd_StAvg",
    "qd_StAddPin",
    "qd_StAddOver",
    "qd_StSubPin",
    "qd_StTransparent",
    "qd_StMax",
    "qd_StSubOver",
    "qd_StMin",
    "qd_StHilite",
    "qd_SlMask8",
    "qd_SlMask9",
    "qd_SlMask10",
    "qd_SlMask11",
    "qd_SlxMask8",
    "qd_SlxMask9",
    "qd_SlxMask10",
    "qd_SlxMask11",
    "qd_SlAvg",
    "qd_SlAddPin",
    "qd_SlAddOver",
    "qd_SlSubPin",
    "qd_SlTransparent",
    "qd_SlMax",
    "qd_SlSubOver",
    "qd_SlMin",
    "qd_SlHilite",
    "qd_ItabMatch",
    "qd_Colorthing2Index",
    "Myst_B93",
    "qd_AllocRunbuf",
    "qd_InitRgn",
    "qd_Scaleblt",
    "qd_StnoStack",
    "qd_Blitcase",
    "qd_Stscanloop",
    "qd_Picitem1",
    "qd_MakeGrayItab",
    "qd_FastLine",
    "qd_FastSlant",
    "qd_BitsDevloop",
    "Myst_B9F",
    "Myst_BA0",
    "Myst_BA1",
    "Myst_BA2",
    "Myst_BA3",
    "Myst_BA4",
    "Myst_BA5",
    "Myst_BA6",
    "Myst_BA7",
    "qd_Stcolortab",
    "qd_Stgraytab",
    "qd_StSearchtab",
    "qd_ScaleIndxd2Indxd",
    "Myst_BAC",
    "Myst_BAD",
    "Myst_BAE",
    "Myst_BAF",
    "Myst_BB0",
    "Myst_BB1",
    "Myst_BB2",
    "Myst_BB3",
    "Myst_BB4",
    "Myst_BB5",
    "Myst_BB6",
    "Myst_BB7",
    "Myst_BB8",
    "Myst_BB9",
    "Myst_BBA",
    "qd_Barith16Setup",
    "qd_Barith32Setup",
    "Myst_BBD",
    "Myst_BBE",
    "Myst_BBF",
    "qd_AlphaDispatch",
    "qd_StreamToMask",
    "QT_MatrixMathDispatch",
    "NQD_Misc",
    "qd_GetpmData",
    "Myst_BC5",
    "Myst_BC6",
    "Myst_BC7",
    "Myst_BC8",
    "IconDispatch",
    "DeviceLoop",
    "Myst_BCB",
    "Myst_BCC",
    "Myst_BCD",
    "UnicodeDispatch",
    "ProcessMgrDispatch",
    "Myst_BD0",
    "Myst_BD1",
    "Myst_BD2",
    "Myst_BD3",
    "Myst_BD4",
    "Myst_BD5",
    "Myst_BD6",
    "Myst_BD7",
    "Myst_BD8",
    "Myst_BD9",
    "Myst_BDA",
    "Myst_BDB",
    "Myst_BDC",
    "Myst_BDD",
    "Myst_BDE",
    "Myst_BDF",
    "Myst_BE0",
    "Myst_BE1",
    "Myst_BE2",
    "Myst_BE3",
    "Myst_BE4",
    "Myst_BE5",
    "Myst_BE6",
    "Myst_BE7",
    "Myst_BE8",
    "Myst_BE9",
    "ModemMgr",
    "DisplayMgr",
    "ButtonMgr",
    "DragDispatch",
    "ColorMatch",
    "TTSMgr",
    "AROSE",
    "GestaltValueDispatch",
    "ThreadDispatch",
    "EddyTrap",
    "XTNDMgr",
    "DSPManager",
    "CollectionMgr",
    "SynchIdleTime",
    "StdOpcodeProc",
    "AuxDispatch",
    "Myst_BFA",
    "GX_Message_Mgr",
    "TranslationMgr",
    "Myst_BFD",
    "GXPrint_Mgr",
    ""
};


static int indent;
static FILE *trapLog;


void fprintlog(const char *format, ...) {
    va_list ap;
    
    if (!trapLog)
        trapLog = fopen("traplog.txt", "w");
    va_start(ap, format);
    fprintf(trapLog, "%*s", 4*indent, "");
    vfprintf(trapLog, format, ap);
    va_end(ap);
}


void logTrap(UInt16 trapWord, UInt32 regs[16]) {
    UInt32 pc;
    UInt16 trapNum;
    const char *trapName;
    
    if (!trapLog)
        trapLog = fopen("traplog.txt", "w");
    
    pc = m68k_getpc();
    
    if (trapWord & 0x800) {
        trapNum = trapWord & 0x3ff;
        trapName = tbTrapName[trapNum];
    } else {
        trapNum = trapWord & 0xff;
        trapName = osTrapName[trapNum];
    }
    
    fprintf(trapLog,
            "%*s%08lx %04x[%03x] %s\n",
            4*indent, "", pc, trapWord, trapNum, trapName);
    fflush(trapLog);
    
    (void)regs;
}


void logOSErr(OSErr err, StringPtr ioNamePtr) {
    if (!trapLog)
        trapLog = fopen("traplog.txt", "w");
    fprintf(trapLog, "%*s    = %d %.*s\n",
            4*indent, "", err,
            ioNamePtr ? ioNamePtr[0] : 0,
            ioNamePtr ? (char *)ioNamePtr + 1 : "");
    fflush(trapLog);
}


void closeLog(void) {
    fclose(trapLog);
    trapLog = 0;
}


void increaseIndent(void) {
    ++indent;
}


void decreaseIndent(void) {
    --indent;
}


#else /* !LOGGING */

void fprintlog(const char *format, ...) { (void)format; }
void logTrap(UInt16 trapWord, UInt32 regs[16]) { (void)trapWord; (void)regs; }
void logOSErr(OSErr err, StringPtr ioNamePtr) { (void)err; (void)ioNamePtr; }
void closeLog(void) {}
void increaseIndent(void) {}
void decreaseIndent(void) {}

#endif /* LOGGING */
